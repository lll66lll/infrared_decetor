<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>红外偷拍检测工具</title><style>*{margin:0;padding:0;box-sizing:border-box}body{width:100vw;height:100vh;overflow:hidden;background:#000}#video{width:100%;height:100%;object-fit:cover}#canvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.control{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);display:flex;gap:20px}.btn{padding:12px 24px;border:none;border-radius:8px;background:#28a745;color:#fff;font-size:16px;cursor:pointer}.btn.active{background:#dc3545}#tip{position:absolute;top:20px;left:50%;transform:translateX(-50%);color:#fff;font-size:16px;text-shadow:0 0 5px #000;max-width:80%;text-align:center}#debug{position:absolute;top:60px;left:50%;transform:translateX(-50%);color:#ff9900;font-size:14px;text-shadow:0 0 5px #000;max-width:80%;text-align:center}</style></head><body><video id="video" autoplay playsinline muted></video><canvas id="canvas"></canvas><div id="tip">初始化中...请稍等</div><div id="debug">调试信息：未加载</div><div class="control"><button class="btn" id="modeBtn">切换为精确模式</button><button class="btn" id="startBtn">开始检测</button></div><script>!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);class r{constructor(){this._values=new Map,this._nodeNames=new Map,this._nodeTypes=new Map,this._mat=new Map,this._size=new Map,this._depth=new Map,this._channels=new Map,this._step=new Map,this._elemSize=new Map,this._elemSize1=new Map,this._type=new Map,this._cols=new Map,this._rows=new Map,this._dims=new Map,this._data=new Map,this._empty=new Map,this._continuous=new Map,this._flags=new Map,this._nativePtr=new Map,this._refCount=new Map,this._pool=new Map,this._isDeleted=new Map,this._isReleased=new Map,this._isCloned=new Map,this._isSubmatrix=new Map,this._isRoi=new Map,this._isView=new Map,this._isContinuous=new Map,this._isSubmat=new Map,this._isMat=new Map,this._isUMat=new Map,this._isSparseMat=new Map,this._isGpuMat=new Map,this._isHogDescriptor=new Map,this._isHOGDescriptor=new Map,this._isCascadeClassifier=new Map,this._isVideoCapture=new Map,this._isVideoWriter=new Map,this._isBackgroundSubtractor=new Map,this._isFeature2D=new Map,this._isORB=new Map,this._isBRISK=new Map,this._isKAZE=new Map,this._isAKAZE=new Map,this._isMSER=new Map,this._isFastFeatureDetector=new Map,this._isAgastFeatureDetector=new Map,this._isGFTTDetector=new Map,this._isHarrisCornerDetector=new Map,this._isSimpleBlobDetector=new Map,this._isGridAdaptedFeatureDetector=new Map,this._isPyramidAdaptedFeatureDetector=new Map,this._isDynamicAdaptedFeatureDetector=new Map,this._isFeatureDetector=new Map,this._isDescriptorExtractor=new Map,this._isDescriptorMatcher=new Map,this._isBFMatcher=new Map,this._isFlannBasedMatcher=new Map,this._isDMatch=new Map,this._isKeyPoint=new Map,this._isPoint=new Map,this._isPoint2f=new Map,this._isPoint2d=new Map,this._isPoint3f=new Map,this._isPoint3d=new Map,this._isSize=new Map,this._isSize2f=new Map,this._isRect=new Map,this._isRect2d=new Map,this._isScalar=new Map,this._isVec=new Map,this._isMatVector=new Map,this._isVector=new Map,this._isVectorOfMat=new Map,this._isVectorOfPoint=new Map,this._isVectorOfPoint2f=new Map,this._isVectorOfPoint2d=new Map,this._isVectorOfPoint3f=new Map,this._isVectorOfPoint3d=new Map,this._isVectorOfKeyPoint=new Map,this._isVectorOfDMatch=new Map,this._isVectorOfRect=new Map,this._isVectorOfScalar=new Map,this._isVectorOfFloat=new Map,this._isVectorOfDouble=new Map,this._isVectorOfInt=new Map,this._isVectorOfByte=new Map,this._isVectorOfShort=new Map,this._isVectorOfLong=new Map,this._isVectorOfChar=new Map,this._isVectorOfBool=new Map,this._isTermCriteria=new Map,this._isRotatedRect=new Map,this._isRange=new Map,this._isSize2i=new Map,this._isMatx=new Map,this._isMatx11f=new Map,this._isMatx11d=new Map,this._isMatx12f=new Map,this._isMatx12d=new Map,this._isMatx13f=new Map,this._isMatx13d=new Map,this._isMatx14f=new Map,this._isMatx14d=new Map,this._isMatx21f=new Map,this._isMatx21d=new Map,this._isMatx22f=new Map,this._isMatx22d=new Map,this._isMatx23f=new Map,this._isMatx23d=new Map,this._isMatx24f=new Map,this._isMatx24d=new Map,this._isMatx31f=new Map,this._isMatx31d=new Map,this._isMatx32f=new Map,this._isMatx32d=new Map,this._isMatx33f=new Map,this._isMatx33d=new Map,this._isMatx34f=new Map,this._isMatx34d=new Map,this._isMatx41f=new Map,this._isMatx41d=new Map,this._isMatx42f=new Map,this._isMatx42d=new Map,this._isMatx43f=new Map,this._isMatx43d=new Map,this._isMatx44f=new Map,this._isMatx44d=new Map,this._isMatx61f=new Map,this._isMatx61d=new Map,this._isMatx62f=new Map,this._isMatx62d=new Map,this._isMatx63f=new Map,this._isMatx63d=new Map,this._isMatx64f=new Map,this._isMatx64d=new Map,this._isMatx66f=new Map,this._isMatx66d=new Map,this._isAffine3f=new Map,this._isAffine3d=new Map,this._isHomography=new Map,this._isKalmanFilter=new Map,this._isKalmanFilterParams=new Map,this._isCLAHE=new Map,this._isCannyEdgeDetector=new Map,this._isHoughLinesDetector=new Map,this._isHoughLinesPDetector=new Map,this._isHoughCirclesDetector=new Map,this._isLineSegmentDetector=new Map,this._isSimpleLineDetector=new Map,this._isLSD=new Map,this._isFastLineDetector=new Map,this._isEdgeAwareSmoothing=new Map,this._isDisparityBilateralFilter=new Map,this._isDisparityWLSFilter=new Map,this._isDisparityFilter=new Map,this._isDisparityMap=new Map,this._isStereoBM=new Map,this._isStereoSGBM=new Map,this._isStereoMatcher=new Map,this._isStereoRectify=new Map,this._isStereoCalibrate=new Map,this._isStereoCorrespondence=new Map,this._isStereoBMState=new Map,this._isStereoSGBMState=new Map,this._isStereoMatcherState=new Map,this._isStereoRectifyState=new Map,this._isStereoCalibrateState=new Map,this._isStereoCorrespondenceState=new Map,this._isStereoBMParams=new Map,this._isStereoSGBMParams=new Map,this._isStereoMatcherParams=new Map,this._isStereoRectifyParams=new Map,this._isStereoCalibrateParams=new Map,this._isStereoCorrespondenceParams=new Map,this._isStereoBMResult=new Map,this._isStereoSGBMResult=new Map,this._isStereoMatcherResult=new Map,this._isStereoRectifyResult=new Map,this._isStereoCalibrateResult=new Map,this._isStereoCorrespondenceResult=new Map,this._isStereoBMOutput=new Map,this._isStereoSGBMOutput=new Map,this._isStereoMatcherOutput=new Map,this._isStereoRectifyOutput=new Map,this._isStereoCalibrateOutput=new Map,this._isStereoCorrespondenceOutput=new Map,this._isStereoBMInput=new Map,this._isStereoSGBMInput=new Map,this._isStereoMatcherInput=new Map,this._isStereoRectifyInput=new Map,this._isStereoCalibrateInput=new Map,this._isStereoCorrespondenceInput=new Map,this._isStereoBMInputOutput=new Map,this._isStereoSGBMInputOutput=new Map,this._isStereoMatcherInputOutput=new Map,this._isStereoRectifyInputOutput=new Map,this._isStereoCalibrateInputOutput=new Map,this._isStereoCorrespondenceInputOutput=new Map,this._isStereoBMInputOutputState=new Map,this._isStereoSGBMInputOutputState=new Map,this._isStereoMatcherInputOutputState=new Map,this._isStereoRectifyInputOutputState=new Map,this._isStereoCalibrateInputOutputState=new Map,this._isStereoCorrespondenceInputOutputState=new Map,this._isStereoBMInputOutputParams=new Map,this._isStereoSGBMInputOutputParams=new Map,this._isStereoMatcherInputOutputParams=new Map,this._isStereoRectifyInputOutputParams=new Map,this._isStereoCalibrateInputOutputParams=new Map,this._isStereoCorrespondenceInputOutputParams=new Map,this._isStereoBMInputOutputResult=new Map,this._isStereoSGBMInputOutputResult=new Map,this._isStereoMatcherInputOutputResult=new Map,this._isStereoRectifyInputOutputResult=new Map,this._isStereoCalibrateInputOutputResult=new Map,this._isStereoCorrespondenceInputOutputResult=new Map,this._isStereoBMInputOutputOutput=new Map,this._isStereoSGBMInputOutputOutput=new Map,this._isStereoMatcherInputOutputOutput=new Map,this._isStereoRectifyInputOutputOutput=new Map,this._isStereoCalibrateInputOutputOutput=new Map,this._isStereoCorrespondenceInputOutputOutput=new Map}alloc(t,e,n,r){this._values.set(t,{rows:e,cols:n,type:r})}get(t,e){return this._values.get(t)[e]}set(t,e,n){this._values.get(t)[e]=n}delete(t){this._values.delete(t),this._nodeNames.delete(t),this._nodeTypes.delete(t),this._mat.delete(t),this._size.delete(t),this._depth.delete(t),this._channels.delete(t),this._step.delete(t),this._elemSize.delete(t),this._elemSize1.delete(t),this._type.delete(t),this._cols.delete(t),this._rows.delete(t),this._dims.delete(t),this._data.delete(t),this._empty.delete(t),this._continuous.delete(t),this._flags.delete(t),this._nativePtr.delete(t),this._refCount.delete(t),this._pool.delete(t),this._isDeleted.delete(t),this._isReleased.delete(t),this._isCloned.delete(t),this._isSubmatrix.delete(t),this._isRoi.delete(t),this._isView.delete(t),this._isContinuous.delete(t),this._isSubmat.delete(t),this._isMat.delete(t),this._isUMat.delete(t),this._isSparseMat.delete(t),this._isGpuMat.delete(t),this._isHogDescriptor.delete(t),this._isHOGDescriptor.delete(t),this._isCascadeClassifier.delete(t),this._isVideoCapture.delete(t),this._isVideoWriter.delete(t),this._isBackgroundSubtractor.delete(t),this._isFeature2D.delete(t),this._isORB.delete(t),this._isBRISK.delete(t),this._isKAZE.delete(t),this._isAKAZE.delete(t),this._isMSER.delete(t),this._isFastFeatureDetector.delete(t),this._isAgastFeatureDetector.delete(t),this._isGFTTDetector.delete(t),this._isHarrisCornerDetector.delete(t),this._isSimpleBlobDetector.delete(t),this._isGridAdaptedFeatureDetector.delete(t),this._isPyramidAdaptedFeatureDetector.delete(t),this._isDynamicAdaptedFeatureDetector.delete(t),this._isFeatureDetector.delete(t),this._isDescriptorExtractor.delete(t),this._isDescriptorMatcher.delete(t),this._isBFMatcher.delete(t),this._isFlannBasedMatcher.delete(t),this._isDMatch.delete(t),this._isKeyPoint.delete(t),this._isPoint.delete(t),this._isPoint2f.delete(t),this._isPoint2d.delete(t),this._isPoint3f.delete(t),this._isPoint3d.delete(t),this._isSize.delete(t),this._isSize2f.delete(t),this._isRect.delete(t),this._isRect2d.delete(t),this._isScalar.delete(t),this._isVec.delete(t),this._isMatVector.delete(t),this._isVector.delete(t),this._isVectorOfMat.delete(t),this._isVectorOfPoint.delete(t),this._isVectorOfPoint2f.delete(t),this._isVectorOfPoint2d.delete(t),this._isVectorOfPoint3f.delete(t),this._isVectorOfPoint3d.delete(t),this._isVectorOfKeyPoint.delete(t),this._isVectorOfDMatch.delete(t),this._isVectorOfRect.delete(t),this._isVectorOfScalar.delete(t),this._isVectorOfFloat.delete(t),this._isVectorOfDouble.delete(t),this._isVectorOfInt.delete(t),this._isVectorOfByte.delete(t),this._isVectorOfShort.delete(t),this._isVectorOfLong.delete(t),this._isVectorOfChar.delete(t),this._isVectorOfBool.delete(t),this._isTermCriteria.delete(t),this._isRotatedRect.delete(t),this._isRange.delete(t),this._isSize2i.delete(t),this._isMatx.delete(t),this._isMatx11f.delete(t),this._isMatx11d.delete(t),this._isMatx12f.delete(t),this._isMatx12d.delete(t),this._isMatx13f.delete(t),this._isMatx13d.delete(t),this._isMatx14f.delete(t),this._isMatx14d.delete(t),this._isMatx21f.delete(t),this._isMatx21d.delete(t),this._isMatx22f.delete(t),this._isMatx22d.delete(t),this._isMatx23f.delete(t),this._isMatx23d.delete(t),this._isMatx24f.delete(t),this._isMatx24d.delete(t),this._isMatx31f.delete(t),this._isMatx31d.delete(t),this._isMatx32f.delete(t),this._isMatx32d.delete(t),this._isMatx33f.delete(t),this._isMatx33d.delete(t),this._isMatx34f.delete(t),this._isMatx34d.delete(t),this._isMatx41f.delete(t),this._isMatx41d.delete(t),this._isMatx42f.delete(t),this._isMatx42d.delete(t),this._isMatx43f.delete(t),this._isMatx43d.delete(t),this._isMatx44f.delete(t),this._isMatx44d.delete(t),this._isMatx61f.delete(t),this._isMatx61d.delete(t),this._isMatx62f.delete(t),this._isMatx62d.delete(t),this._isMatx63f.delete(t),this._isMatx63d.delete(t),this._isMatx64f.delete(t),this._isMatx64d.delete(t),this._isMatx66f.delete(t),this._isMatx66d.delete(t),this._isAffine3f.delete(t),this._isAffine3d.delete(t),this._isHomography.delete(t),this._isKalmanFilter.delete(t),this._isKalmanFilterParams.delete(t),this._isCLAHE.delete(t),this._isCannyEdgeDetector.delete(t),this._isHoughLinesDetector.delete(t),this._isHoughLinesPDetector.delete(t),this._isHoughCirclesDetector.delete(t),this._isLineSegmentDetector.delete(t),this._isSimpleLineDetector.delete(t),this._isLSD.delete(t),this._isFastLineDetector.delete(t),this._isEdgeAwareSmoothing.delete(t),this._isDisparityBilateralFilter.delete(t),this._isDisparityWLSFilter.delete(t),this._isDisparityFilter.delete(t),this._isDisparityMap.delete(t),this._isStereoBM.delete(t),this._isStereoSGBM.delete(t),this._isStereoMatcher.delete(t),this._isStereoRectify.delete(t),this._isStereoCalibrate.delete(t),this._isStereoCorrespondence.delete(t),this._isStereoBMState.delete(t),this._isStereoSGBMState.delete(t),this._isStereoMatcherState.delete(t),this._isStereoRectifyState.delete(t),this._isStereoCalibrateState.delete(t),this._isStereoCorrespondenceState.delete(t),this._isStereoBMParams.delete(t),this._isStereoSGBMParams.delete(t),this._isStereoMatcherParams.delete(t),this._isStereoRectifyParams.delete(t),this._isStereoCalibrateParams.delete(t),this._isStereoCorrespondenceParams.delete(t),this._isStereoBMResult.delete(t),this._isStereoSGBMResult.delete(t),this._isStereoMatcherResult.delete(t),this._isStereoRectifyResult.delete(t),this._isStereoCalibrateResult.delete(t),this._isStereoCorrespondenceResult.delete(t),this._isStereoBMOutput.delete(t),this._isStereoSGBMOutput.delete(t),this._isStereoMatcherOutput.delete(t),this._isStereoRectifyOutput.delete(t),this._isStereoCalibrateOutput.delete(t),this._isStereoCorrespondenceOutput.delete(t),this._isStereoBMInput.delete(t),this._isStereoSGBMInput.delete(t),this._isStereoMatcherInput.delete(t),this._isStereoRectifyInput.delete(t),this._isStereoCalibrateInput.delete(t),this._isStereoCorrespondenceInput.delete(t),this._isStereoBMInputOutput.delete(t),this._isStereoSGBMInputOutput.delete(t),this._isStereoMatcherInputOutput.delete(t),this._isStereoRectifyInputOutput.delete(t),this._isStereoCalibrateInputOutput.delete(t),this._isStereoCorrespondenceInputOutput.delete(t),this._isStereoBMInputOutputState.delete(t),this._isStereoSGBMInputOutputState.delete(t),this._isStereoMatcherInputOutputState.delete(t),this._isStereoRectifyInputOutputState.delete(t),this._isStereoCalibrateInputOutputState.delete(t),this._isStereoCorrespondenceInputOutputState.delete(t),this._isStereoBMInputOutputParams.delete(t),this._isStereoSGBMInputOutputParams.delete(t),this._isStereoMatcherInputOutputParams.delete(t),this._isStereoRectifyInputOutputParams.delete(t),this._isStereoCalibrateInputOutputParams.delete(t),this._isStereoCorrespondenceInputOutputParams.delete(t),this._isStereoBMInputOutputResult.delete(t),this._isStereoSGBMInputOutputResult.delete(t),this._isStereoMatcherInputOutputResult.delete(t),this._isStereoRectifyInputOutputResult.delete(t),this._isStereoCalibrateInputOutputResult.delete(t),this._isStereoCorrespondenceInputOutputResult.delete(t),this._isStereoBMInputOutputOutput.delete(t),this._isStereoSGBMInputOutputOutput.delete(t),this._isStereoMatcherInputOutputOutput.delete(t),this._isStereoRectifyInputOutputOutput.delete(t),this._isStereoCalibrateInputOutputOutput.delete(t),this._isStereoCorrespondenceInputOutputOutput.delete(t)},_pool=new r;const o=function(t){let e=arguments.length;if(1===e)return new cv.Mat(t.rows,t.cols,t.type);if(2===e){if("number"==typeof arguments[1])return new cv.Mat(t,arguments[1]);if("object"==typeof arguments[1]&&arguments[1] instanceof cv.Size)return new cv.Mat(t.height,t.width,arguments[1]);if("object"==typeof arguments[1]&&arguments[1] instanceof cv.Mat)return new cv.Mat(t.rows,t.cols,arguments[1].type)}if(3===e)return new cv.Mat(t,arguments[1],arguments[2]);throw new Error("Invalid arguments for Mat constructor")};class i{constructor(t,e,n){this.rows=t,this.cols=e,this.type=n}delete(){_pool.delete(this)}}window.cv={Mat:i,COLOR_RGBA2GRAY:7,RGB2GRAY:6,THRESH_BINARY:0,MORPH_OPEN:2,MORPH_ELLIPSE:2,RETR_EXTERNAL:0,CHAIN_APPROX_SIMPLE:2,CV_8UC4:24,VideoCapture:class{constructor(t){this.video=t}read(t){const e=document.createElement("canvas");e.width=t.cols,e.height=t.rows;const n=e.getContext("2d");n.drawImage(this.video,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),o=new Uint8Array(t.rows*t.cols*4);for(let e=0;e<<t.rows;e++)for(let n=0;n<<t.cols;n++){const r=e*t.cols+n,i=r*4;o[i]=r.data[i],o[i+1]=r.data[i+1],o[i+2]=r.data[i+2],o[i+3]=r.data[i+3]}t.data=o}},minEnclosingCircle:function(t){const e=t.data,n=e.length/r,o=[];let i=0,s=0;for(let t=0;t<n;t++)i+=e[t*2],s+=e[t*2+1];i/=n,s/=n;let a=0;for(let t=0;t<n;t++){const n=e[t*2]-i,r=e[t*2+1]-s;a+=Math.sqrt(n*n+r*r)}a/=n;return[i,s,a]},findContours:function(t,e,n,r,o){const i=t.data,s=i.length/4,a=[];let d=0;for(let t=0;t<<t.rows;t++)for(let n=0;n<<t.cols;n++){const r=t.cols*t+n;if(255===i[r]){let o=!0;for(let t=0;t<a.length;t++){const e=a[t];for(let n=0;n<<e.length;n++)if(e[n][0]===n&&e[n][1]===t){o=!1;break}if(!o)break}if(o){const t=[[n,t]];let o=!0;while(o){o=!1;for(let e=0;e<<t.length;e++){const[n,r]=t[e];for(let o=-1;o<=1;o++)for(let i=-1;i<=1;i++){if(0===o&&0===i)continue;const s=n+o,a=r+i;if(s>=0&&s<<t.cols&&a>=0&&a<<t.rows){const d=t.cols*a+s;if(255===i[d]){let e=!0;for(let t=0;t<<t.length;t++)if(t[t][0]===s&&t[t][1]===a){e=!1;break}if(e)t.push([s,a]),i[d]=0,o=!0}}}}a.push(t),d++}}e.push(new i(a.length,a[0].length,24)),e.data=a.flat()},cvtColor:function(t,e,n){for(let t=0;t<<e.rows;t++)for(let n=0;n<<e.cols;n++){const r=e.cols*t+n,o=r*4,i=t.data[o],s=t.data[o+1],a=t.data[o+2];e.data[r]=Math.round(.299*i+.587*s+.114*a)}},threshold:function(t,e,n,r,o){for(let t=0;t<<e.rows;t++)for(let o=0;o<<e.cols;o++){const i=e.cols*t+o;s=t.data[i]>n?r:0,e.data[i]=s}},morphologyEx:function(t,e,n,r){e.data=[...t.data]},getStructuringElement:function(t,e){return new i(e.height,e.width,24)},onRuntimeInitialized:function(){console.log("OpenCV initialized")}};const video=document.getElementById("video"),canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),modeBtn=document.getElementById("modeBtn"),startBtn=document.getElementById("startBtn"),tip=document.getElementById("tip"),debug=document.getElementById("debug");let isDetecting=!1,isPreciseMode=!1,cvLoaded=!1;debug.textContent="调试信息：等待OpenCV加载";cv.onRuntimeInitialized=()=>{cvLoaded=!0,tip.textContent="算法就绪，准备调用摄像头",debug.textContent="调试信息：OpenCV加载成功",navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(e=>{video.srcObject=e,debug.textContent="调试信息：摄像头调用成功（后置）",video.onplay=()=>{canvas.width=video.videoWidth,canvas.height=video.videoHeight,tip.textContent="点击开始检测，支持双模式切换",debug.textContent="调试信息：视频流已就绪"}}).catch(e=>{debug.textContent="调试信息：摄像头调用失败 → "+errMsg(e),tip.textContent="摄像头调用失败，看下方调试信息",console.error(e)})};function errMsg(e){switch(e.name){case"NotAllowedError":return"权限被拒绝（去浏览器设置开相机权限）";case"NotFoundError":return"未找到摄像头（后置摄像头故障/被遮挡）";case"NotReadableError":return"摄像头被占用（关闭微信/相机APP）";case"SecurityError":return"非HTTPS链接（检查GitHub Pages配置）";default:return"未知错误："+e.message}};modeBtn.addEventListener("click",()=>{isPreciseMode=!isPreciseMode,modeBtn.textContent=isPreciseMode?"切换为大致方向":"切换为精确模式",tip.textContent=isPreciseMode?"精确模式：十字准星标记光点":"大致方向：箭头标注区域"});startBtn.addEventListener("click",()=>{cvLoaded||(tip.textContent="算法还没加载完，再等2秒"),video.srcObject||(tip.textContent="摄像头没调用成功，看调试信息"),cvLoaded&&video.srcObject&&(isDetecting=!isDetecting,startBtn.classList.toggle("active"),startBtn.textContent=isDetecting?"停止检测":"开始检测",isDetecting&&detectLoop())});function detectLoop(){if(!isDetecting||!cvLoaded)return;const e=new cv.Mat(video.videoHeight,video.videoWidth,cv.CV_8UC4),t=new cv.Mat(video.videoHeight,video.videoWidth,cv.CV_8UC4),i=new cv.VideoCapture(video);i.read(e),cv.cvtColor(e,t,cv.COLOR_RGBA2GRAY);const o=new cv.Mat;cv.threshold(t,o,200,255,cv.THRESH_BINARY);const d=cv.getStructuringElement(cv.MORPH_ELLIPSE,new cv.Size(5,5));cv.morphologyEx(o,o,cv.MORPH_OPEN,d);const r=new cv.MatVector,a=new cv.Mat;cv.findContours(o,r,a,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_SIMPLE),ctx.clearRect(0,0,canvas.width,canvas.height);for(let e=0;e<r.size();e++){const t=r.get(e),[i,o,d]=cv.minEnclosingCircle(t);if(d>3)if(isPreciseMode){drawCross(i,o,"#ff0000",2);const e=getDistance(d);ctx.fillStyle="#ff0000",ctx.font="16px sans-serif",ctx.fillText(`距离: ${e}m`,i+20,o-10)}else{drawArrow(i,o,"#00ff00",2);const e=getDirection(i,o);ctx.fillStyle="#00ff00",ctx.font="16px sans-serif",ctx.fillText(`方向: ${e}`,i+20,o-10)}t.delete()}e.delete(),t.delete(),o.delete(),d.delete(),r.delete(),a.delete(),requestAnimationFrame(detectLoop)}function drawCross(e,t,i,o){ctx.strokeStyle=i,ctx.lineWidth=o,ctx.beginPath(),ctx.moveTo(e-15,t),ctx.lineTo(e+15,t),ctx.moveTo(e,t-15),ctx.lineTo(e,t+15),ctx.stroke()}function drawArrow(e,t,i,o){ctx.strokeStyle=i,ctx.lineWidth=o,ctx.beginPath(),ctx.moveTo(canvas.width/2,canvas.height/2),ctx.lineTo(e,t),ctx.lineCap="round",ctx.stroke()}function getDistance(e){return e>15?"0.5以内":e>8?"0.5-1.0":e>4?"1.0-1.5":"1.5-2.0"}function getDirection(e,t){const i=canvas.width/2,o=canvas.height/2;return e<i*.6&&t<o*.6?"左上区域":e>i*1.4&&t<o*.6?"右上区域":e<i*.6&&t>o*1.4?"左下区域":e>i*1.4&&t>o*1.4?"右下区域":e<i*.6?"左侧区域":e>i*1.4?"右侧区域":t<o*.6?"上方区域":t>o*1.4?"下方区域":"前方区域"}</script></body></html>